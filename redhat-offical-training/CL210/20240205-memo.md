# DAY 1

## 오픈스택 CL210 과정

__강사:__ 최국현

__이메일:__ tang@linux.com

[메모파일](https://github.com/tangt64/training_memos/blob/main/redhat-offical-training/CL210/20240205-memo.md)

[화이트 보드](https://wbd.ms/share/v2/aHR0cHM6Ly93aGl0ZWJvYXJkLm1pY3Jvc29mdC5jb20vYXBpL3YxLjAvd2hpdGVib2FyZHMvcmVkZWVtLzVkYTkxMDdmNDk4ZTQwMDJhY2JmN2Y5ZWQwMDhjYTk5X0JCQTcxNzYyLTEyRTAtNDJFMS1CMzI0LTVCMTMxRjQyNEUzRF8wZDRiOGUyMy1iMjk3LTQwYjItOTIyMS04MTEyYzQzZGRkMGI=)

점심시간: 12전후

쉬는시간: 10~15분정도


## 랩 소개

```
RHEL/Rocky
Podman/Docker

RHEL 8<=
Podman 
```

- student/student
- root/redhat

1. 터미널 하나 실행
2. 'sudo dnf install gnome-tweaks -y'
3. 'gnome-tweaks'
4. 'extension -> Application Menu, Desktop Icons, Windows List'
5. 'Window -> Min/Max Window Size' 


## 오픈스택 자동화

>자동화 엔지니어 또는 DevOps 엔지니어

1. Ansible/terraform/salt
2. OpenStack CI/CD(ZUUL)
3. Heat
4. API(OpenStack)
5. Image Build(OS+APP+LIB)

## 지나가면서...(운영체제)

Network(NetworkManager, systemd-networked)
---

__"NetworkManager"__모든 배포판에서 지원 및 사용. 최종적으로는 모든 배포판은 __"systemd-networked"__으로 통합. 앞으로는 __ifcfg-rh__형식은 지원하지 않음.

추후에 모든 네트워크는 시스템 블록인 "systemd"기반인 __"systemd-networkd"__ 로 통합. 현재 모든 배포판에서 사용이 가능.

[네트워크 매니저 마이그레이션 기능](https://opensource.com/article/22/8/migrate-networkmanager-keyfiles-configuration)

[systemd 네트워크](https://www.freedesktop.org/software/systemd/man/latest/)systemd.network.html


NTP(systemd-timedated)
---
1. NTPD
2. Chornyd

[systemd NTP](https://www.freedesktop.org/software/systemd/man/latest/systemd-timesyncd.service.html)

## podman


```bash
cd /etc/containers/
> policy.json     ## redhat.com위주로 구성 및 설정
> registries.conf

podman images
podman pods ls          ## 포드 조회
podman container ls       ## 컨테이너 조회
podman ps


## 컨테이너 상태 정보 저장위치

cd /var/lib/containers/storage/
> overlay             ## 컨테이너 모든 정보는 여기에 저장이 되어 있음
> overlay-containers
> overlay-images
```
1. POD+Container(POD(APP, Init 1))
2. dumb-init(syscall, Init 1)
> systemd. openstack-nova-compute.service | systemctl start httpd


# DAY 2

## 오픈스택 백업

1. 데이타베이스 백업(mariadb, mysql)
2. 설정파일(control-plane, compute, neutron backup)
3. 스토리지 백업 대상에서 제외
4. 이미지 백업(glance에 존재하는 이미지)
5. OS설정 부분(RHEL+UBI+Podman)


1. YAML: 인프라
2. TOML: 설정
3. JSON: 데이터


```bash
## BOOTSTRAPING
0. DOMAIN(testDomain)     ---> openstack domain create testSDS
1. ROLE(testRole)         ---> openstack role create testRole --domain testSDS
2. USER(testUser)         ---> openstack user create testUser --domain testSDS
3. PROJECT(testProject)   ---> openstack project create testProject --domain testSDS


ASSIGNMENT=ROLE{USER+PROJECT}  ---> openstack role add --user testUser --project testProject testRole

                               { REGION }
                                   |
                                   |        
                                RegionOne
                                   |
                                   |
                               { DOMAIN } ---> [SDS]
                                   |
                                   |
                             D(d)efault ---> { USER }
                                   /    ---> { PROJECT }
                                  /
                               { ROLE }
                                /
                               /   
         .---> openstack role create freeuser     ## 메타정보만 생성
        /                            --------
		OSP(ROLE)                          /
        \                           mapping
         \                           /
          `---> policy.json ---> policy.yaml
                                   [RBAC]
                                      - swiftoperator
                                      - member(_member_)
                                      - service
                                      - admin


                 ROLE --- GROUP --- USER(s)
                                     --group testGroup

                                    100(user_rbac)

```


qemu: 예물레이터 
- device
  + disk(qcow2-3, raw)
  + cpu
  + memory
  + bios
  + mainboard
  + nic(full)


>Near-raw performance, competitive with QED.
>Fully QCOW2 backwards-compatible feature set.
>Extensibility to tackle current and future storage virtualization challenges.


```bash

Copy On Write
Copy On Read

                        
                      [ volume ]   --- { cinder }
                           ^
                           |
                           |
                 .----> instance x 10 (COW)
                /
             backing file(device)
              /
+----------------+
|   base image   | COR
+----------------+

qemu-img info blahblah.qcow2
> format: qcow3
> virtio, para-virtualization driver 


qemu, libvirtd
```


kvm: 가상화 가속기(intel/amd)
- kvm.ko(irqbypass)
  + kvm_intel
  + kvm_amd

```bash


qemu-img

````

# DAY 3

## 디스크 이미지 빌드 도구

공통사항
---
가상머신 이미지를 다루는 도구는 __"libguestfs-tools-c"__ 으로 제공. 이 명령어들은 보통 __'virt-????'__으로 시작.



1. diskimage-builder

디렉터리 프레임워크 기반. 

2. oz

XML(DOM)를 통해서 이미지 빌드 정보. 

3. virt-builder
---
내부 혹은 외부 저장소에서 표준 이미지를 내려받기 후, 옵션에 따라서 패키지 설치 및 구성을 진행. 

```bash
virt-builder --list
virt-builder alma-8.5 -o alma.raw

sudo LIBGUESTFS_BACKEND=direct virt-builder --size 8G --format qcow2 --root-password password:redhat alma-8.5 --hostname build.example.com --install httpd,vsftpd -o alma-8G.qcow2
```


4. manual(수동으로 구성)

libvirt, virt-install 이미지 생성 후, 수동으로 가상머신 이미지 구성.

```bash
dnf install libvirt-client virt-install
virsh net-list
virsh pool-list 
mv alma-8.5.qcow2 /var/lib/libvirt/images/alma.qcow2
virt-install --name test-alma --memory 1024 --vcpu 2 --disk=path=/var/lib/libvirt/images/alma.qcow2 --net default --import --noautoconsole
virsh list
virsh console <VM_ID>
> ctrl + ]
virsh destroy <VM_ID>
virsh undefine <VM_NAME>
```

5. virt-sysprep, virt-sparsify

```bash
virt-sysprep -a /var/lib/libvirt/images/alma.qcow2
virt-sparsify /var/lib/libvirt/images/alma.qcow2 ~/alma-sealed.qcow2
openstack image create --file ~/alam-sealed.qcow2 --format qcow2 --public alma-sealed
```


# DAY 4