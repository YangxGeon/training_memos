
# DAY 1

## 랩 정보

먼저 워크스테이션에 접근 및 로그인 부탁 드립니다!

```bash
rol.redhat.com --> 랩 --> "Console Open" Workstation
```
1. root/redhat
2. student/student

```bash
sudo dnf install gnome-tweaks -y
gnome-tweaks
> extensions -> application menu, Desktop Icon, Windows List
> windows -> Max, Min
```

- 쉬는시간 10/15분 
- 점심시간 12:00(1시 30분)


**시간이 부족할것 같으면 점심시간 및 쉬는 시간 조정하겠습니다!**


## 오픈스택

QEMU/KVM
>KVM은 초기에 가상화 가속기. 본래 인텔 전용 하이퍼바이저 커널 모듈. dom0(xen, vmware, hyperv). 
>QEMU를 통해서 가상 자원을 생성 및 관리(qemu-kvm)
>가상머신들을 관리하기 위해서 libvirtd라는 라이브러리 대몬 서비스가 추가
>하드웨어 및 소프트웨어 관계 및 구성
>컨테이너 기반으로 오픈스택 서비스를 구성

커널기술
>kvm.ko(intel_kvm.ko, amd_kvm.ko)
>namespace, cgroup

컨테이너 기술
>contaienrd, docker(*)
>podman


## 레드햇 오픈스택

1. Pacemaker
>데이터베이스(mariadb) 및 OVS/OVN 데이터베이스 관련
2. haproxy
>로드 밸런서 용도로 사용함
3. rabbitmq
>zeromq > rabbitmq, 컨트롤러 및 컴퓨트 혹은 기타 인프라 노드에 작업 전달이 잘 되지 않을때, 일반적으로 메세지 브로커 서비스의 부하가 많이 걸림.
4. oslo
>오픈스택 프레임워크.
5. 로그파일 및 설정파일
>/var/log/config-data, /var/log/containers/, journalctl


# DAY 2

## rabbitmqctl

```bash
rabbitmqctl list_users
rabbitmqctl list_vhosts
rabbitmqctl list_bindings
rabbitmqctl list_channels
rabbitmqctl list_consumers
rabbitmqctl list_exchanges
rabbitmqctl list_queues

rabbitmqctl status
rabbitmqctl report
rabbitmqctl ping 
```

## ReaR

```bash
cd /usr/share/ansible/roles/backup-and-restore/tasks/
> cat pacemaker_backup.yml
cd /usr/share/ansible/roles/backup-and-restore/backup/tasks/
> cat db_backup.yml

# https://www.puppet.com/docs/puppet/7/hiera_intro.html
```
아직 대다수 관리 스크립트는 퍼팻 모듈 기반으로 동작함.

```bash
dnf search libguestfs
dnf provide virt-builder
> libguestfs-tools-c
dnf install libguestfs-tools-c
virt-builder --list
> https://docs.openstack.org/image-guide/obtain-images.html
> | grep cirros

virt-builder cirros-0.3.5
file cirros-0.3.5.img
qemu-img info cirros-0.3.5.img

qemu-img convert -f raw -O qcow2 cirros-0.3.5.img cirros-0.3.5.qcow2
```

왜 대다수 오픈소스 이미지는 ".raw"으로 구성이 되어 있는가?
>이미지 전환 및 수정이 편하기 때문에


```bash
## diskimg-builder, virt-builder, oz...이미지 생성
## 1단계
virt-builder --size 10G --format qcow2 -o centos-7.qcow2 centos-7
virt-builder --size 10G --format qcow2 -o centos-stream-9.qcow2 centosstream-9


## 파일 삭제
## 호스트이름 및 네트워크 정보
virt-sysprep -a centos-7.qcow2

## 
virt-sparsfiy -a centos-7.qcow2

```


# 요청사항
1. OVS/OVN 추가 내용
2. 오픈스택 설치(커뮤니티)
3. 수업중에 안정성 때문에 OVS/OVN 대신 Linux Bridge를 많이 사용한다고 하셨는데.. 그럼 상대적으로 OVS/OVN의 장애율이 높다는 말씀인가요?
4. 오픈스택 업그레이드에 대해서도 다뤄주시면 감사하겠습니다. 16에서17로 업그레이드
5. 식사후에 ovs vs ovn의 선택 기준을 설명 부탁 드립니다.(리눅스 브릿지 아님)
6. user/project, domain, region구성

# 메모 및 링크 정리

[OVN/OVS](https://smart-edge-open.github.io/ido-specs/doc/building-blocks/dataplane/smartedge-open-ovn/)
[Open vSwitch and OVN 2021 Fall Conference](https://www.openvswitch.org/support/ovscon2021/)
[OVN Arch](https://www.ovn.org/en/architecture/)
[About OVN](http://www.openvswitch.org//support/slides/OVN-Vancouver.pdf)
[History of OVS/OVN](https://developers.redhat.com/blog/2019/08/30/the-clean-break-of-open-virtual-network-from-open-vswitch?source=sso#three_stages_of_separation)

[오픈스택 블록장치 리스트](https://docs.openstack.org/cinder/latest/reference/support-matrix.html)
[glusterfs](https://www.gluster.org/)

[컴퓨트 노드 스토리지 설계](https://docs.openstack.org/arch-design/design-compute/design-compute-storage.html)


## ovs/ovn

- Stage 1: Separate the packaging of OVN from OVS.
- Stage 2: Create a separate OVN source repo, including OVS as a Git subtree.
- Stage 3: Eliminate the OVS subtree, allowing compilation of OVN using a remote installation of OVS.



## ovs/ovn vs lb

ovs: bridge link, tap기본 기능을 포함하여, 추가기능 및 관리기능 확장.
ovn: firewall, route(router), policy와 같은 기능을 포함하며, 추가기능 및 관리기능 확장이 가능.

ovs/ovn: userspace(성능)
linux bridge, linux route, linux firewal: kernelspace(안전성)

## 강의 시작전 리캡
1. rabbitmqctl
2. rear 백업 범위 및 기능 확인