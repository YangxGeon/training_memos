# DAY 1

## 강사 소개

이름: 최국현

메일: tang@linux.com

## 메모 및 자료 파일 내려받기

[메모](https://github.com/tangt64/training_memos)
>opensource-101
>>oci-docker-101
>>>20240311-memo.md
>>>20240311-files

__google:__ "hyper-v create nat switch"


## 하이퍼브이 에이전트 설치(가상머신)

```bash
dnf search hyperv
dnf install hyperv* -y 
reboot 
```


```
                                [1:1]
     fedora --->        centos  <---> RHEL
[rolling update]       --------
                           \
                            `---> centos-stream    --->     RHEL
                                [rolling update]        [down stream]
```


## 도커 설치

```bash
dnf -y install dnf-plugins-core
dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
systemctl start docker
docker run hello-world
docker ps -a
> 8358b98078fc   hello-world   "/hello"   6 seconds ago   Exited (0) 5 seconds ago             pensive_merkle
```

## 포드만 설치(podman-vm)

```bash
dnf install podman -y
podman run hello-world
podman ps -a
> 4ca98c55c1a6  quay.io/podman/hello:latest  /usr/local/bin/po...  3 seconds ago  Exited (0) 4 seconds ago              admiring_kirch
```

## 기술 및 용어 설명

1. container runtime/engine

docker-engine
---
컨테이너 생성 및 관리는 하지 않음. 엔진은 일반적으로 두 가지 형태로 작업을 요청받음.

1. API
2. Socket

```bash
   .--- k8s와 상관 없음 --.                 .-----> K8S사용 가능
  /                       \               /
docker ps -- <API> --> [dockerd] ---> [containerd]
                        daemon
```

## docker runtime(rootless)

```bash
[containerd] ---> [runc] ---> [conmon] ---> <container>
```

## cri-docker(mirantis docker)

현재 도커는 두개로 분리. 기존 도커 시스템(docker-ee, docker-ce)그대로 유지하며, cri-docker로 별도로 구성. 현재 쿠버네티스는 두 가지 도컨 런타임을 지원. 


## podman-engine(daemonless,rootless)
---
포드만은 별도로 엔진이 없음. 포드만 데스크탑 혹은 TUI기반으로 사용시 사용이 가능.


## 정리

- __컨테이너 엔진:__ 일반적으로 개발용이나 혹은 독립적으로 사용하는 시스템.
- __컨테이너 런타임:__ 일반적으로 컨테이너를 실행 및 관리하는 시스템. 

- __daemonless/rootless:__ 현재 오픈소스는 엔진도 데몬리스 형태로 지원하고 있음. 도커는 아직 데몬리스 형태를 제공하지 않음.  


### 1. Podman, Docker

#### Podman

오픈소스 버전의 Docker라고 보시면 됨. 도커하고 결이 맞지 않아서.


- Containerfile
- podman == docker
- docker search == skopeo
- docker build == buildah(공식은 빌더)


#### Docker

클로즈드 버전의 컨테이너 엔진. 루트리스 컨테이너 엔진 및 런타임 원조. 단점이라고 하면, 엔진 및 런타임이 무거움. 

- Dockerfile

### 2. namespace

호스트 프로세스(userspace)를 격리하는 커널 영역. 가상 자원을 커널에서 생성해서 사용자 프로세스에 전달 및 공유.

1. 가상장치 제공(mnt, net, ipc, time)
2. 분리 및 격리
3. 사용자 영역(userspace)에서 발생한 데이터를 커널로 전달해주는 역할.
4. 링 구조

```bash

container --- subuid/gid --- namespace uid/gid

  systemd
     |
  systemd
   |    \
   |	[namespace]
   |		 |
   |  	<container_user>
[sshd]	     |
		     |
		      `container(binary) + [cgroup]
		           \
		            `---> cracked!!

```

### 3. cgroup

초기 컨테이너는 __"cgroup"__ 기반으로 구현 및 구성. 구글에서 작성 후, 리눅스 커뮤니티에 기여. BSD에서 __"chroot"__ 기반으로 컨테이너 비슷하게 구성. "cgroup"를 통해서 프로세스 추적 및 감사. 도커 및 포드만에서는 모든 "cgroup"자원을 제어가 가능하지만, 쿠버네티스에서는 "cpu", "mem"만 가능. 

```bash

## docker, podman은 모든 영역 지원
## kubernetes는 "cpu", "memory"만 지원

container(binary)  + cgroup(policy)
   \                     \
    `---> cpu(k8s)        `---> cpu: 1000, memory: 500kib
          memory(k8s)
          disk
          network
```
### 4. OCI/CRI/CNI

__CRI:__ __Container Runtime Interface__ 를 통해서 연결. 다만, 도커는 CRI인터페이스를 제공하지 않음. 어뎁터를 통해서 __containerd__ 를 통해서 쿠버네티스와 연결 제공. 명령어는 현재 도커 명령어를 표준으로 사용. 

__OCI:__ Open Container Initiative, 많이 다루는 부분은 이미지. 흔히 말하는 컨테이너 이미지. 컨테이너 이미지는 overlay기반으로 구성. overlay는 일종의 디렉터리 바인딩 기술(컨테이너 이미지 마운트).

__CNI:__ Container Network Interface, 이를 통해서 컨테이너에서 사용하는 네트워크(infra network, container network)를 제공.



# DAY 2


# DAY 3


# 링크

[도커 vs 포드만](https://www.redhat.com/ko/topics/containers/what-is-podman)