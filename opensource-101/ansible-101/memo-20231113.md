# day 1

메모파일 위치
---
https://github.com/tangt64/training_memos
>/opensource-101
>/ansible-101

해당 위치에 메모파일 및 예제파일 있습니다. :)

화이트보드 위치
---
[마소 화이트 보드](https://wbd.ms/share/v2/aHR0cHM6Ly93aGl0ZWJvYXJkLm1pY3Jvc29mdC5jb20vYXBpL3YxLjAvd2hpdGVib2FyZHMvcmVkZWVtLzU1NjBhNjBiZTFkNDQ4ODE4YjM5MmIxMTU0ODUwZjg4X0JCQTcxNzYyLTEyRTAtNDJFMS1CMzI0LTVCMTMxRjQyNEUzRF9kMDAzZTRmYS01YzMwLTQ0ZWEtYmI1OC05YWI0NWZiZWMwZDQ=)

크롬 및 엣지 브라우저에서 접근 및 확인 가능.

## 설치준비

하이퍼브이 설치
---
```
제어판 -> Windows 기능 켜기/끄기 -> Hyper-V, 가상머신 플랫폼, Windows 하이퍼바이저 플랫폼
```

로키 리눅스 이미지
---
https://rockylinux.org/download

WLS2
---
```
제어판 -> Windows 기능 켜기/끄기 -> Linux용 Window 하위 시스템
```
[CentOS-9-Stream WSL2 이미지](https://github.com/mishamosher/CentOS-WSL/releases )

Windows Terminal
---
[Windows Terminal 설치하기](https://apps.microsoft.com/detail/windows-terminal/9N0DX20HK701?hl=en-US&gl=US)

__Google keyword:__ Windows Termianl



## 앤서블 소개


1. ansible core: 앤서블 프로그램 + 핵심 모듈
2. ansible engine: 앤서블 프로그램 + 핵심 모듈 + 확장 모듈
3. 현재는 ansible core + 확장 모듈


### 앤서블 설치

```bash
## node1(VM), rocky
dnf search ansible
> ansible-core
dnf install ansible-core 

## WSL2(Container), centos-9-stream
dnf search ansible
> ansible-core
> ansible
dnf install ansible 
```

### 앤서블 에디터 설정

```bash
## WSL2 CentOS or node1
# https://webinstall.dev/vim-ale/
#
dnf install git curl -y
curl -sS https://webi.sh/vim-ale | sh 
dnf install epel-release -y
dnf search yamllint
dnf install yamllint.noarch -y 

## nano editor 
# https://github.com/serialhex/nano-highlight/blob/master/yaml.nanorc

curl -o ~/.nanorc https://raw.githubusercontent.com/serialhex/nano-highlight/master/yaml.nanorc
```


```bash
cat <<EOF>> ~/.nanorc
set tabsize 2
set tabstospaces
EOF
```

```yaml
  1 ---
  2 - name: test task
  3   hosts: all
  4
  5   tasks:
  6     - name: first task
  7     - name: second task
```

1. JSON: API DATA(PAYLOAD)
2. YAML: Human readable data serialization(YAML -> JSON)
3. TOML: A config file format for humans

```
YAML -> JSON -> [API_SERVER]
----
\
 `---> <LOAD_UP> ---> ansible-engine ---> <COMPILE> ---> byte_code
       =========      --------------
          MEM               |
                     confing/inventory
                            |
                            ^
                           / \
                          /   \
                        TOML  INI==YAML   
                              ---
                               **(이게 쉬워용 ㅎ)

TOML -> [APPLICATION]
```

## 명령어 정리

```bash
ansible: localhost혹은 ad-hoc명령어
> ansible localhost, -m setup
> rpm -ql ansible-core

## 첫번째 VM에서 작업 진행
#
dnf install ansible-core --releasever 9
ip addr show eth0           ## 아이피 주소 확인
mkdir firstansible
cd firstansible
cat <<EOF> inventory
172.23.164.189
EOF

ansible all --inventory-file inventory -m setup

ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa
ls -l ~/.ssh/id_rsa
> /root/.ssh/id_rsa
ssh-copy-id root@<IP_ADDRESS>
> Number of key(s) added: 1
ansible all --inventory-file inventory -m setup

ansible all --inventory-file inventory -m shell -a ls

ansible-doc -l
ansible-doc shell

sshpass -pansible ssh -o StrictHostKeyChecking=no root@10.10.10.110      ## fingerprint키 검사 하지 않음.
```

```yaml
---
- name: first my playbook
  hosts: <NODE1_IP>

  tasks:
  - name: show my hostname
    shell: hostname
  - name: install the httpd packages
    package:
      name: httpd
      state: present
```

복습 :)
---

1. node2번에 hostname명령어가 올바르게 동작하도록 설정한다.
> __ansible all --inventory-file inventory -m shell -a hostname__
2. node2번에는 앤서블 설치가 필요하지 않다.
3. node1번에서 node2번으로 ssh public key 전달이 필요하다.

## 용어정리
- __inventory(인벤토리):__ 앤서블에서 사용하는 서버 목록
- __managed node:__ 앤서블에서 관리하는 서버 혹은 가상머신
- __control node:__ 앤서블이 설치가 되어 있거나, 실행되는 서버 혹은 가상머신(컨테이너 포함)
- __모듈(module):__ 앤서블에서 특정 기능을 실행하는 함수파일 